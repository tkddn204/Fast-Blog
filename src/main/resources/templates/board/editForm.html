<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<body>
<!-- Page content-->
<div layout:fragment="content">
    <div class="container mt-5">
        <div class="row">
            <div class="col-lg-12">
                <!-- Post content-->
                <header class="mb-4">
                    <h1 class="fw-bolder mb-1">글 수정</h1>
                </header>
                <form action="" th:action method="post" th:object="${board}" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label class="form-label" for="title">글 제목</label>
                        <input class="form-control" id="title"
                               th:id="title" th:name="title"
                               th:errorclass="field-error"
                               placeholder="제목을 입력하세요."
                               th:value="${originBoard?.title}">
                        <div class="text-danger" th:errors="*{title}">제목 검증 오류</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="content">글 내용</label>
                        <textarea class="form-control" rows="3" id="content"
                                  th:id="content" th:name="content"
                                  th:errorclass="field-error"
                                  placeholder="내용을 입력하세요."
                                  th:text="${originBoard?.content}">
                        </textarea>
                        <div class="text-danger" th:errors="*{content}">내용 검증 오류</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">이미지 업로드</label>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="btn-file-select btn btn-outline-secondary" for="file">파일 선택</label>
                                <button type="button" class="btn-file-delete btn btn-danger" onclick="onClickDeleteFile()">삭제</button>
                            </div>
                            <label class="btn-file-select-text input-group-text"
                                   for="file"
                                   th:text="${originBoard?.storedFileName}"></label>
                            <input class="form-control custom-file-input" name="file"
                                   th:field="*{file}"
                                   th:errorclass="field-error"
                                   onchange="onChangeFileInput(this)"
                                   type="file"
                                   id="file">
                            <input type="hidden" name="fileName" id="fileName"
                                th:value="${originBoard?.storedFileName}">
                        </div>
                    </div>
                    <div class="mb-3">
                        <button type="submit" class="btn btn-primary btn-sm">저장</button>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="location.href='/'">취소</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<th:block layout:fragment="script">
    <script type="text/javascript">
        const fileDeleteButton = document.querySelector(".btn-file-delete");
        const fileSelectButton = document.querySelector(".btn-file-select");
        const fileSelectText = document.querySelector(".btn-file-select-text");
        const fileInputElement = document.querySelector("#file");
        const fileSelectHiddenName = document.querySelector("#fileName");

        function init() {
            onChangeFileInput(fileSelectHiddenName);
        }

        function onChangeFileInput(fileInputElement) {
            const value = fileInputElement.value;
            console.log(value);
            if (value) {
                fileDeleteButton.classList.remove('btn-file-delete');
                fileSelectButton.style.display = 'none';
            } else {
                fileSelectButton.style.display = 'block';
                fileDeleteButton.classList.add('btn-file-delete');
            }
            fileSelectText.textContent = value;
            fileSelectHiddenName.value = value;
        }

        function onClickDeleteFile() {
            if (confirm("파일을 삭제하시겠습니까?")) {
                fileInputElement.value = "";
                onChangeFileInput(fileInputElement);
            }
        }

        init();
    </script>
</th:block>
</body>
</html>
